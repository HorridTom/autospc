% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_code.R
\name{plot_auto_SPC}
\alias{plot_auto_SPC}
\title{Plot SPC charts with automated limit recalculation}
\usage{
plot_auto_SPC(
  df,
  x,
  y,
  n,
  chartType = NULL,
  periodMin = 21,
  runRuleLength = 8,
  noRecals = FALSE,
  noRegrets = TRUE,
  overhangingReversions = TRUE,
  maxNoOfExclusions = 3,
  highlightExclusions = TRUE,
  mr_screen_max_loops = 1L,
  rule2Tolerance = 0,
  floatingMedian = "no",
  floatingMedian_n = 12L,
  plotChart = TRUE,
  showLimits = TRUE,
  showMR = TRUE,
  writeTable = FALSE,
  verbosity = 1L,
  title = NULL,
  subtitle = NULL,
  use_caption = TRUE,
  override_x_title = NULL,
  override_y_title = NULL,
  override_y_lim = NULL,
  x_break = NULL,
  x_date_format = "\%Y-\%m-\%d",
  x_pad_end = NULL,
  r1_col = "orange",
  r2_col = "steelblue3",
  includeAnnotations = TRUE,
  annotation_size = 3,
  align_labels = FALSE,
  flip_labels = FALSE,
  upper_annotation_sf = NULL,
  lower_annotation_sf = NULL,
  annotation_arrows = FALSE,
  annotation_arrow_curve = 0.3,
  override_annotation_dist = NULL,
  override_annotation_dist_P = NULL
)
}
\arguments{
\item{df}{A data frame. For an XMR, C or C' chart, must have columns for:
\itemize{
\item the subgrouping variable, to be plotted on the horizontal axis, (x);
\item the variable of interest to be plotted on the vertical axis (y);
\item and optionally, a title and subtitle for the plot.
} \cr
For a P or P' chart, must have columns for:
\itemize{
\item the subgrouping variable, to be plotted on the horizontal axis, (x);
\item the total count or denominator (n);
\item the count meeting criteria, or numerator (y);
\item and optionally, a title and subtitle for the plot.
}}

\item{x}{Name of column (passed using tidyselect semantics) to use as
subgroups on the horizontal axis of the chart.}

\item{y}{Name of column (passed using tidyselect semantics) to use as:
\itemize{
\item the variable to be plotted for XMR charts,
\item count (plotted on the vertical axis) for C and C' charts,
\item numerator of the proportion (plotted on the vertical axis) for P and
P' charts.
}}

\item{n}{Name of column (passed using tidyselect semantics) to use as
denominator for P and P' charts.}

\item{chartType}{The type of chart you wish to plot. Available options are:
"XMR", "MR", "C", "C'", "P", "P'".
\subsection{Algorithm Parameters}{
}}

\item{periodMin}{The minimum number of points (subgroups) per period,
i.e. the minimum number of points required to form control limits.}

\item{runRuleLength}{The minimum number of consecutive points above or below
the centre line constituting a shift (or "rule 2") break.}

\item{noRecals}{Boolean - if TRUE, do not recalculate control limits, instead
extend limits calculated from the first periodMin points.}

\item{noRegrets}{Boolean signifying which version of the algorithm should be
used. Defines whether limits can change as more data is added or not.}

\item{overhangingReversions}{Boolean determining whether rule breaks in the
opposite direction to a rule break triggering a candidate recalculation
prevent recalculation even if they overhang the end of the candidate
calculation period. Set to FALSE only with noRegrets = FALSE.
\subsection{SPC Parameters}{
}}

\item{maxNoOfExclusions}{The maximum number of extreme points to exclude from
limit calculations.}

\item{highlightExclusions}{Boolean signifying whether excluded points are
greyed out.}

\item{mr_screen_max_loops}{Integer or Inf specifying maximum number of times
to recursively ignore mr values above the upper range limit when calculating
xmr limits. Note this does not affect the calculation of the upper range
limit on the mr chart.}

\item{rule2Tolerance}{Minimum difference between a point's vertical position
and the centre line to count as "on the centre line" for the purposes of
shift rule breaks}

\item{floatingMedian}{Whether to add a floating median line to the chart,
calculated based on the final floatingMedian_n data points on the chart:
"no" - do not display a floating median,
"yes" - display a floating median,
"auto" - display a floating median if and only if there is at least one point
that is part of a shift rule break in the final floatingMedian_n data points
on the chart.}

\item{floatingMedian_n}{The number of points to use for calculation of the
floating median, if present.
\subsection{Output Type}{
}}

\item{plotChart}{Boolean specifying whether to plot the chart. If not, the
data is returned with centre line, control limits and other analytic output
appended as columns.}

\item{showLimits}{Boolean controlling whether or not to display centre line
and control limits}

\item{showMR}{Logical controlling whether the moving range chart is included
in XMR chart}

\item{writeTable}{Boolean specifying whether to save the data as a CSV
(useful for doing lots of charts at a time).}

\item{verbosity}{Integer specifying how talkative the algorithm is; the
higher the number the more information is provided, none if 0.
\subsection{Chart Appearance}{
}}

\item{title}{Optional string specifying chart title. Overrides df$title.}

\item{subtitle}{Optional string specifying subtitle. Overrides df$subtitle.}

\item{use_caption}{Boolean controlling whether the caption is displayed.}

\item{override_x_title}{String specifying horizontal axis label.}

\item{override_y_title}{String specifying vertical axis label.}

\item{override_y_lim}{Optional numeric specifying upper limit of the
vertical axis.}

\item{x_break}{Optional numeric specifying spacing of horizontal axis breaks.}

\item{x_date_format}{Optional string format for date labels on horizontal
axis. Passed to scales::date_format.}

\item{x_pad_end}{Optional, specifies a minimum end point for the horizontal
axis.}

\item{r1_col}{Highlight colour for breaks of rule 1 (points outside the
control limits)}

\item{r2_col}{Highlight colour for breaks of rule 2 (shifts)}

\item{includeAnnotations}{Boolean specifying whether to show centre line
labels}

\item{annotation_size}{Text size for centre line labels}

\item{align_labels}{Boolean specifying whether or not to align centre line
labels at a fixed vertical position}

\item{flip_labels}{Boolean specifying whether or not to place centre line
labels on different sides of the centre line depending on the direction of
change from the previous period}

\item{upper_annotation_sf}{Numeric scale factor specifying upper vertical
position of centre line labels as a multiple of the upper control limit}

\item{lower_annotation_sf}{Numeric scale factor specifying lower vertical
position of centre line labels as a multiple of the lower control limit}

\item{annotation_arrows}{Boolean specifying whether or not to display arrows
connecting centre line labels to the centre line they refer to}

\item{annotation_arrow_curve}{Numeric curvature of the annotation arrows}

\item{override_annotation_dist}{Deprecated}

\item{override_annotation_dist_P}{Deprecated}
}
\value{
An SPC ggplot or corresponding data
}
\description{
\code{plot_auto_SPC()} creates a statistical process control chart from a
dataframe, applying the Stable Shift Algorithm to automate recalculation of
control limits.
}
\examples{
# Using a C' chart to track changes in the count of monthly attendance 
plot_auto_SPC(
  ed_attendances_monthly, 
  chartType = "C'", 
  x = Month_Start, 
  y = Att_All
)
   
#Using a P' chart to track changes in the percentage admitted within 4 hours
plot_auto_SPC(
  ed_attendances_monthly, 
  chartType = "P'", 
  x = Month_Start, 
  y = Within_4h, 
  n = Att_All
)

#using a runRuleLength of 7 when tracking monthly attendance
plot_auto_SPC(
  ed_attendances_monthly, 
  chartType = "C'", 
  x = Month_Start, 
  y = Att_All,
  runRuleLength = 7
)

}
