---
title: "The Stable Shift Algorithm"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{The Stable Shift Algorithm}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(autospc)
library(dplyr)
library(scales)
```

# Introduction

The *autospc* package implements the *Stable Shift Algorithm* for
re-establishing control limits in statistical process control (SPC) analysis.
This vignette describes the problem the algorithm addresses, sets out some
useful terminology, and describes the algorithm.

# The problem

A standard approach in SPC analysis for quality improvement goes as follows:

1. Establish a baseline:
    - gather or extract data over a period of time prior to a planned
    improvement initiative
    - plot this data on a control chart, forming baseline control limits
2. Extend the baseline limits into the future
3. Add data to the chart as time progresses, without updating the control limits

This is exemplified in the following three charts.

```{r 1.1, fig.width=7, fig.height=4.3}
plot_auto_SPC(
  ed_attendances_monthly %>%
    filter(row_number() <= 24),
  periodMin = 24,
  chartType = "C'",
  x = Month_Start, 
  y = Att_All,
  title = "1. Establish a baseline",
  use_caption = FALSE
) +
  ggplot2::scale_x_date(breaks = date_breaks(width = "3 months"))
```
```{r 1.2, fig.width=7, fig.height=4.3}
plot_auto_SPC(
  ed_attendances_monthly %>%
    filter(row_number() <= 24),
  periodMin = 24,
  chartType = "C'",
  x = Month_Start, 
  y = Att_All,
  extend_limits_to = as.Date("2018-04-01"),
  title = "2. Extend the baseline limits",
  use_caption = FALSE
) +
  ggplot2::scale_x_date(breaks = date_breaks(width = "3 months"))
```

```{r 1.3, fig.width=7, fig.height=4.3}
plot_auto_SPC(
  ed_attendances_monthly %>%
    filter(row_number() <= 30),
  periodMin = 24,
  chartType = "C'",
  x = Month_Start, 
  y = Att_All,
  extend_limits_to = as.Date("2018-04-01"),
  title = "3. Add data to the chart as time progresses",
  use_caption = FALSE
) +
  ggplot2::scale_x_date(breaks = date_breaks(width = "3 months"))
```

As data is added, the process may shift to a higher or lower level. Indeed, this
is often the aim of an improvement initiative. This prompts the question of
whether and when the control limits should be re-established to better represent
the new process. Whilst various textbooks and online resources offer opinions on
this issue, there is no universally accepted approach. The Stable Shift
Algorithm (SSA) offers an automated, consistent and rigorous approach to
re-establishing control limits.

# The Stable Shift Algorithm: Overview

# Some terminology

# The Stable Shift Algorithm: Details

# Using the algorithm log




